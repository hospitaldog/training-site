<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GIS As-Built Training Library</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 32px; line-height: 1.5; }
    h1 { margin-bottom: 0.25rem; }
    .sub { color:#666; margin-top:0 }
    #search { width: 100%; max-width: 520px; padding: 10px 12px; font-size: 16px; margin: 16px 0 24px; }
    .group { margin: 28px 0; }
    .file { margin: 6px 0; }
    .ext { display:inline-block; min-width: 64px; color:#888; font-size: 12px; text-transform: uppercase; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <h1>GIS As-Built Training Library</h1>
  <p class="sub">All files in this repo are listed automatically. Use search to filter.</p>

  <input id="search" type="search" placeholder="Search files… (e.g., arcmap, fittings, maop)" />

  <div id="content">Loading…</div>

<script>
  // ✅ Your repo info
  const GH_USER = "hospitaldog";
  const GH_REPO = "training-site";
  const BRANCH  = "main";              // change if your default branch is not 'main'
  const SUBFOLDERS = [];               // e.g., ["ArcMap", "Fittings"]

  function apiUrl(path="") {
    const clean = path ? `/${path.replace(/^\/+/,"")}` : "";
    return `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents${clean}?ref=${BRANCH}`;
  }

  async function fetchDir(path="") {
    const url = apiUrl(path);
    const res = await fetch(url, { headers: { "Accept": "application/vnd.github.v3+json" }});
    if (!res.ok) {
      const text = await res.text().catch(()=> "");
      throw new Error(`GitHub API error ${res.status} ${res.statusText} at ${url}\n${text}`);
    }
    return res.json();
  }

  function humanName(filename) {
    return filename.replace(/[-_]+/g, " ").replace(/\.[^.]+$/,"");
  }

  function linkFor(path) {
    // Link to the GitHub Pages URL for the raw file
    return `https://${GH_USER}.github.io/${GH_REPO}/${path}`;
  }

  function render(files) {
    const content = document.getElementById("content");
    const byExt = {};
    files.forEach(f => {
      if (f.type !== "file") return;
      if (f.name.toLowerCase() === "index.html") return;
      const ext = (f.name.split(".").pop() || "").toLowerCase();
      (byExt[ext] ||= []).push(f);
    });

    content.innerHTML = "";
    const exts = Object.keys(byExt).sort();
    if (exts.length === 0) {
      content.textContent = "No files found in this repository.";
      return;
    }

    exts.forEach(ext => {
      const group = document.createElement("div");
      group.className = "group";
      const h2 = document.createElement("h2");
      h2.textContent = ext ? ext.toUpperCase() : "FILES";
      group.appendChild(h2);

      byExt[ext].sort((a,b)=>a.name.localeCompare(b.name)).forEach(f=>{
        const p = document.createElement("p");
        p.className = "file";
        p.dataset.filename = f.name.toLowerCase();
        const a = document.createElement("a");
        a.href = linkFor(f.path);
        a.textContent = humanName(f.name);
        a.target = "_blank";
        const tag = document.createElement("span");
        tag.className = "ext";
        tag.style.display = "inline-block";
        tag.style.minWidth = "64px";
        tag.style.color = "#888";
        tag.style.fontSize = "12px";
        tag.style.textTransform = "uppercase";
        tag.textContent = ext;
        p.appendChild(tag);
        p.appendChild(a);
        group.appendChild(p);
      });
      content.appendChild(group);
    });

    // simple search
    const search = document.getElementById("search");
    search.addEventListener("input", () => {
      const q = search.value.trim().toLowerCase();
      document.querySelectorAll(".file").forEach(el=>{
        el.style.display = q && !el.dataset.filename.includes(q) ? "none" : "";
      });
    });
  }

  (async function init(){
    const content = document.getElementById("content");
    try {
      const root = await fetchDir("");
      const all = [...root];
      for (const sub of SUBFOLDERS) {
        const kids = await fetchDir(sub);
        kids.forEach(k => k.path = `${sub}/${k.name}`);
        all.push(...kids);
      }
      render(all);
    } catch (e) {
      console.error(e);
      content.textContent = "Failed to load file list:\n" + e.message;
    }
  })();
</script>
  
</body>
</html>


